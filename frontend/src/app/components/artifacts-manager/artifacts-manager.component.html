<div class="artifacts-container">
  
  <!-- Lista de Artefactos (siempre visible) -->
  <div class="artifacts-list">
    <div class="artifacts-header">
      <h3>
        <span class="icon">üì¶</span> Artefactos
      </h3>
      <button 
        class="btn-toggle"
        type="button"
        [attr.data-bs-toggle]="'collapse'"
        [attr.data-bs-target]="'#form' + phaseId"
        [attr.aria-expanded]="false"
        [attr.aria-controls]="'form' + phaseId"
        title="Agregar nuevo artefacto"
      >
        <span class="plus-icon">+</span>
      </button>
    </div>

    <!-- Lista de artefactos existentes -->
    <div *ngIf="artifacts.length === 0" class="no-artifacts">
      <p>No hay artefactos registrados</p>
    </div>
    
    <div *ngFor="let artifact of artifacts" class="artifact-item">
      <div class="artifact-info">
        <span class="artifact-type">{{ artifact.name }}</span>
        
        <!-- Control de estado basado en ArtifactStatus -->
        <div class="status-control ms-3">
          <span [ngClass]="{
            'badge bg-warning text-dark': artifact.status === 0,
            'badge bg-info': artifact.status === 1,
            'badge bg-success': artifact.status === 2
          }">
            {{ artifact.statusName || 'Pendiente' }}
          </span>
        </div>
      </div>
      <small class="text-muted">{{ artifact.isMandatory ? 'Obligatorio' : 'Opcional' }}</small>
    </div>
  </div>

  <!-- Formulario colapsable (solo aparece al hacer clic en +) -->
  <div class="collapse" [id]="'form' + phaseId">
    <div class="form-container">
      <div class="form-header">
        <h6>Nuevo Artefacto</h6>
      </div>
      <form [formGroup]="artifactForm" (ngSubmit)="onSubmit()">
        <div class="row">
          <div class="col-12 mb-3">
            <label for="type" class="form-label">Tipo</label>
            <select id="type" class="form-select form-select-sm" formControlName="type">
              <option [ngValue]="null" disabled>Seleccione...</option>
              <option *ngFor="let type of artifactTypes" [ngValue]="type.value">
                {{ type.key }}
              </option>
            </select>
          </div>
          <div class="col-12 mb-3">
            <label for="author" class="form-label">Autor</label>
            <input type="text" id="author" class="form-control form-control-sm" formControlName="author">
          </div>
        </div>
        <div class="mb-3">
          <label for="content" class="form-label">Contenido (Opcional)</label>
          <textarea id="content" class="form-control form-control-sm" rows="2" formControlName="content"></textarea>
        </div>
        <div class="mb-3">
          <label for="fileInput" class="form-label">Archivo (Opcional)</label>
          <input type="file" id="fileInput" class="form-control form-control-sm" (change)="onFileSelected($event)">
        </div>

        <!-- CORRECCI√ìN AQU√ç: Usamos formControlName en lugar de ngModel -->
        <div class="form-group mt-3">
          <div class="form-check form-switch">
            <input 
                class="form-check-input" 
                type="checkbox" 
                id="mandatorySwitch"
                formControlName="isMandatory"> 
            <label class="form-check-label" for="mandatorySwitch">
                {{ artifactForm.get('isMandatory')?.value ? '‚ö†Ô∏è Obligatorio' : 'üîì Opcional' }}
            </label>
          </div>
          <small class="text-muted">
              Si es obligatorio, no se podr√° avanzar de fase hasta que este artefacto est√© entregado.
          </small>
        </div>

        <!-- Tipo de artefacto (ya no usamos workflows) -->
        <div class="form-group">
          <small class="form-text text-muted">
            El artefacto seguir√° el flujo de estados est√°ndar: Pendiente ‚Üí En Revisi√≥n ‚Üí Aprobado
          </small>
        </div>

        <div class="form-actions">
          <button type="submit" class="btn btn-primary btn-sm" [disabled]="artifactForm.invalid">
            Guardar
          </button>
          <button 
            type="button" 
            class="btn btn-secondary btn-sm" 
            data-bs-toggle="collapse" 
            [attr.data-bs-target]="'#form' + phaseId">
            Cancelar
          </button>
        </div>
      </form>
    </div>
  </div>
</div>